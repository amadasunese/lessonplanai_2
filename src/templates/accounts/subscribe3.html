{% extends '_base.html' %}

{% block content %}
<div class="container mt-5 rounded-lg" style="background: linear-gradient(to right, #f5f5f5, #e0e0e0);">
  <div class="row justify-content-center">
    <div class="col-lg-6 text-center">
      <h2 class="mb-4" style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);">Choose a Subscription Plan</h2>
      
      <form id="paymentForm" class="rounded-lg p-4 bg-light">
        <div class="form-group">
          <label for="email-address">Email Address</label>
          <input type="email" id="email-address" required />
        </div>
        <div class="form-group">
          <label for="amount">Amount</label>
          <input type="tel" id="amount" required />
        </div>
        <div class="form-group">
          <label for="first-name">First Name</label>
          <input type="text" id="first-name" />
        </div>
        <div class="form-group">
          <label for="last-name">Last Name</label>
          <input type="text" id="last-name" />
        </div>
        <div class="form-submit">
          <button type="button" onclick="payWithPaystack()" class="btn btn-primary btn-lg btn-block rounded-pill" style="box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2); transition: all 0.2s ease-in-out;">Pay</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  var paymentForm = document.getElementById('paymentForm');
  paymentForm.addEventListener('submit', payWithPaystack, false);

  function payWithPaystack() {
    var handler = PaystackPop.setup({
      key: 'pk_live_87a006b15465670cb102ad321c55abaa4e32fdb1', // Replace with your public key
      email: document.getElementById('email-address').value,
      amount: document.getElementById('amount').value * 100, // Multiply by 100 to convert to the lowest currency unit
      currency: 'NGN', // Use GHS for Ghana Cedis or USD for US Dollars
      ref: '' + Math.floor((Math.random() * 1000000000) + 1),
      callback: function(response) {
        // Handle the successful payment and update user subscription details
        alert('Success. Transaction ref is ' + response.reference);
        window.location.href = "{{ url_for('core.dashboard') }}"; // Redirect to the dashboard
      },
      onClose: function() {
        alert('Window closed');
      }
    });

    handler.openIframe();
  }
</script>
{% endblock %}
